# ClipFlow AI — 產品需求規格書 (PRD)

> **文件版本**：v2.0 ｜ **最後更新**：2026-02-13
> **文件狀態**：草案 (Draft)

---

## 1. 產品概述

### 1.1 問題描述

創作者在錄製口播 (A-roll) 時，經常 NG 重講。傳統粗剪需要人工完整聽完所有素材，逐段找出「正確的那一遍」，一支 10 分鐘的影片往往需要 30–60 分鐘粗剪。

### 1.2 解決方案

**ClipFlow AI** 讓創作者在拍攝時透過「語音指令」即時標記好壞片段，事後由 AI 語音辨識引擎自動比對標記詞，產出剪輯軟體可直接匯入的時間軸檔案，將粗剪時間縮減 80% 以上。

### 1.3 一句話定位

> 「從錄製時的語音標籤，到剪輯軟體的時間軸」— 創作者的 A-roll 自動粗剪助理。

### 1.4 目標用戶

| 角色                    | 場景             | 痛點                         |
| ----------------------- | ---------------- | ---------------------------- |
| YouTuber / 短影音創作者 | 每日大量口播素材 | 粗剪耗時，拖慢發片節奏       |
| 線上課程老師            | 長時間錄影教學   | 從冗長影片中切出有效段落費力 |
| 剪輯工作室 / Freelancer | 多專案同時進行   | 初步素材整理佔據過多工時     |

---

## 2. 產品演進路線（三階段）

> 核心策略：**地端優先**，快速驗證核心演算法，再逐步包裝為桌面 App 與雲端 SaaS。

```
Phase 1 (MVP)          Phase 2               Phase 3
CLI + 本地 Web UI  →   桌面 App (Electron)  →  SaaS 雲端平台
─────────────────      ──────────────────      ─────────────────
• 核心引擎驗證         • 一鍵安裝體驗          • 多人協作
• 開發者 / 早期用戶    • 一般創作者            • 團隊 / 企業客戶
• 本機運算處理         • 本機 + 可選雲端 API    • 全雲端運算
```

### Phase 1：地端 MVP（本次實作範圍）

**目標**：驗證核心切片邏輯的正確性與實用性。

| 功能模組       | 說明                                               | 優先級 |
| -------------- | -------------------------------------------------- | ------ |
| 音訊提取       | 從影片分離音軌（FFmpeg）                           | P0     |
| 語音轉文字     | 本地調用 Whisper 模型，產出帶時間戳的逐字稿        | P0     |
| 標記詞偵測     | 比對使用者設定的 NG / OK 關鍵字                    | P0     |
| 片段切片       | 根據標記邏輯產出保留 / 捨棄片段清單                | P0     |
| EDL / XML 匯出 | 生成 Premiere Pro / DaVinci Resolve 可匯入的時間軸 | P0     |
| 本地 Web UI    | 拖放上傳、片段預覽、手動微調切點                   | P1     |
| SRT 字幕匯出   | 同步產出已過濾標記詞的字幕檔                       | P1     |
| 一鍵粗剪 MP4   | 直接合併匯出影片（無需剪輯軟體）                   | P2     |

### Phase 2：桌面應用（未來規劃）

- 使用 Electron / Tauri 打包為跨平台桌面 App
- 內建 Whisper 模型，免設定即用
- 支援 GPU 加速（CUDA / Metal）
- 拖放資料夾批次處理
- 可選：連接雲端 API 使用更大模型（付費功能）

### Phase 3：SaaS 雲端平台（未來規劃）

- 雲端轉寫引擎（GPU 叢集）
- 使用者帳號 / 專案管理 / 儲存空間
- 團隊協作（多人校閱、權限管理）
- Webhook / API 整合第三方工作流（如 Zapier、n8n）
- 訂閱制計費（Free / Pro / Team）

---

## 3. 核心演算法邏輯

### 3.1 標記模式

#### 模式 A — 回溯法（預設）

聽到「OK 標記」時，自動保留**往前追溯**到上一個「NG 標記」或「靜音區間」之後的完整語句。

```
時間軸示意：
[拍攝內容] → [NG: "再來"] → [重講內容] → [OK: "這段OK"] → [繼續拍攝]
                                ↑_________保留區間_________↑
```

#### 模式 B — 區間法

使用「開始」與「結束」指令框定保留區間，適用於需要精確控制的場景。

```
時間軸示意：
[拍攝內容] → [START: "開始"] → [保留內容] → [END: "結束"] → [繼續拍攝]
                                ↑________保留區間_______↑
```

### 3.2 切片參數

| 參數                   | 預設值                   | 說明                           |
| ---------------------- | ------------------------ | ------------------------------ |
| `pre_buffer`           | 0.5s                     | 切點前預留緩衝，避免人聲被切斷 |
| `post_buffer`          | 0.3s                     | 切點後預留緩衝                 |
| `silence_threshold`    | -40 dB                   | 靜音判定閾值                   |
| `silence_min_duration` | 1.5s                     | 超過此時長視為靜音區間         |
| `ng_keywords`          | `["再來", "NG", "重來"]` | NG 標記關鍵字（可自定義）      |
| `ok_keywords`          | `["這段OK", "OK", "收"]` | OK 標記關鍵字（可自定義）      |

### 3.3 多語系支援

Phase 1 優先支援：**中文 (zh)**、**英文 (en)**
未來擴充：粵語、日語、韓語

---

## 4. 技術架構

### 4.1 Phase 1 技術棧（地端）

```
┌─────────────────────────────────────────────────┐
│                  本地 Web UI                      │
│          Next.js (React) — localhost:3000         │
└──────────────────────┬──────────────────────────┘
                       │ REST API
┌──────────────────────▼──────────────────────────┐
│               後端 API 伺服器                     │
│            Python + FastAPI — :8000               │
│  ┌──────────┐ ┌──────────┐ ┌──────────────────┐  │
│  │ FFmpeg   │ │ Whisper  │ │ 切片引擎         │  │
│  │ 音訊提取 │ │ STT 本地 │ │ (標記匹配+EDL)   │  │
│  └──────────┘ └──────────┘ └──────────────────┘  │
└──────────────────────┬──────────────────────────┘
                       │ 檔案系統
              ┌────────▼────────┐
              │  本地檔案儲存    │
              │  ./data/         │
              └─────────────────┘
```

| 模組       | 技術選型                 | 說明                                         |
| ---------- | ------------------------ | -------------------------------------------- |
| 音訊提取   | FFmpeg (CLI)             | 從 mp4/mov/mkv 等格式分離 WAV 音軌           |
| 語音轉文字 | `openai-whisper` (本地)  | 使用 `base` / `medium` 模型，支援 CPU 與 GPU |
| 後端 API   | Python 3.11+ / FastAPI   | 處理上傳、轉寫、切片邏輯、匯出               |
| 前端 UI    | Next.js 14+ (App Router) | 拖放上傳、片段預覽、時間軸微調               |
| 影片匯出   | FFmpeg (concat)          | 合併保留片段為 MP4                           |
| 套件管理   | uv + .venv               | Python 虛擬環境與依賴管理                    |

### 4.2 Phase 3 技術棧（雲端，未來）

| 模組   | 技術選型                         | 說明                       |
| ------ | -------------------------------- | -------------------------- |
| 運算   | AWS Lambda / GCP Cloud Run + GPU | 彈性擴容的轉寫運算         |
| 儲存   | S3 / GCS                         | 影片暫存，處理後依策略清除 |
| 資料庫 | PostgreSQL / Supabase            | 用戶資料、專案、標記紀錄   |
| 認證   | Supabase Auth / Clerk            | 使用者帳號管理             |
| 佇列   | Redis + Celery / BullMQ          | 非同步任務處理             |

---

## 5. API 規格（Phase 1 地端）

### 5.1 專案管理

```
POST   /api/projects                  # 建立專案
GET    /api/projects                  # 列出所有專案
GET    /api/projects/{id}             # 取得專案詳情
DELETE /api/projects/{id}             # 刪除專案
```

### 5.2 媒體處理

```
POST   /api/projects/{id}/upload      # 上傳影片檔案
POST   /api/projects/{id}/analyze     # 觸發 AI 分析（音訊提取 → STT → 切片）
GET    /api/projects/{id}/status       # 查詢處理進度
GET    /api/projects/{id}/transcript   # 取得逐字稿（含時間戳）
```

### 5.3 片段操作

```
GET    /api/projects/{id}/segments           # 取得所有切片結果
PATCH  /api/projects/{id}/segments/{seg_id}  # 手動調整切點（start/end）
PUT    /api/projects/{id}/segments/{seg_id}/toggle  # 啟用/停用片段
```

### 5.4 匯出

```
POST   /api/projects/{id}/export/edl    # 匯出 EDL 檔案
POST   /api/projects/{id}/export/xml    # 匯出 XML (FCP/Premiere)
POST   /api/projects/{id}/export/srt    # 匯出 SRT 字幕
POST   /api/projects/{id}/export/video  # 匯出合併 MP4
```

### 5.5 設定

```
GET    /api/settings                  # 取得使用者偏好設定
PUT    /api/settings                  # 更新設定（標記詞、緩衝、語言等）
```

---

## 6. 資料模型

### 6.1 Project

```json
{
	"id": "proj_20260213_001",
	"name": "EP.12 開箱影片",
	"created_at": "2026-02-13T10:00:00+08:00",
	"status": "analyzed",
	"source_file": "EP12_raw.mp4",
	"duration_seconds": 612.5,
	"settings": {
		"mode": "backtrack",
		"language": "zh",
		"ng_keywords": ["再來", "NG"],
		"ok_keywords": ["這段OK", "OK", "收"],
		"pre_buffer": 0.5,
		"post_buffer": 0.3,
		"silence_threshold_db": -40,
		"silence_min_duration": 1.5
	}
}
```

### 6.2 Transcript Word

```json
{
	"word": "今天",
	"start": 2.34,
	"end": 2.78,
	"confidence": 0.96
}
```

### 6.3 Segment

```json
{
	"id": "seg_001",
	"project_id": "proj_20260213_001",
	"type": "keep",
	"start": 15.2,
	"end": 42.8,
	"trigger_marker": { "type": "OK", "word": "這段OK", "timestamp": 42.5 },
	"enabled": true,
	"manual_adjusted": false
}
```

---

## 7. 使用者介面（Phase 1 Web UI）

### 7.1 頁面規劃

| 頁面            | 路由            | 說明                       |
| --------------- | --------------- | -------------------------- |
| 首頁 / 專案列表 | `/`             | 顯示所有專案、新建專案入口 |
| 專案工作區      | `/project/{id}` | 核心編輯介面               |
| 設定            | `/settings`     | 標記詞、模型、語言等偏好   |

### 7.2 專案工作區佈局

```
┌──────────────────────────────────────────────────────────────┐
│  Header：專案名稱 / 匯出按鈕群組                              │
├───────────────┬──────────────────────────────────────────────┤
│               │                                              │
│  左側邊欄      │       中央區域                                │
│  逐字稿面板    │       影片播放器                              │
│               │                                              │
│  • 綠色 = 保留 │       ┌──────────────────────────────┐       │
│  • 灰色 = 捨棄 │       │                              │       │
│  • 紅色 = NG   │       │       Video Player            │       │
│               │       │                              │       │
│  點擊文字可    │       └──────────────────────────────┘       │
│  跳轉播放位置  │                                              │
├───────────────┴──────────────────────────────────────────────┤
│  底部：時間軸                                                 │
│  [■■■■░░░░■■■■■■░░░■■■■■■■■■░░░░░░■■■■■]                    │
│   綠 = 保留片段   灰 = 捨棄片段                                │
│  可拖曳調整切點 / 點擊切換啟用狀態                               │
└──────────────────────────────────────────────────────────────┘
```

---

## 8. 使用者流程

```
1. 拍攝          2. 上傳          3. AI 分析        4. 校閱          5. 匯出
┌──────────┐  ┌──────────┐  ┌──────────────┐  ┌──────────┐  ┌──────────┐
│ 錄影時說  │  │ 拖放影片  │  │ 音訊提取      │  │ 預覽片段  │  │ 下載 EDL │
│ "再來"    │→│ 至 Web UI │→│ → STT 轉文字  │→│ 調整切點  │→│ 匯入剪輯 │
│ "這段OK"  │  │ 設定標記詞│  │ → 標記比對    │  │ 開關片段  │  │ 軟體     │
│           │  │          │  │ → 片段切片    │  │          │  │          │
└──────────┘  └──────────┘  └──────────────┘  └──────────┘  └──────────┘
```

---

## 9. 成功指標

### 9.1 Phase 1 驗收標準

| 指標             | 目標值                         | 測量方式               |
| ---------------- | ------------------------------ | ---------------------- |
| 標記詞識別準確率 | ≥ 95%（安靜環境）              | 使用 10 段測試素材計算 |
| 切片邏輯正確率   | ≥ 90% 片段無需手動修正         | 人工校驗對比           |
| 處理速度         | 10 分鐘素材 ≤ 3 分鐘（含 STT） | 本機 M1/M2 Mac 計時    |
| EDL 匯入成功率   | 100%（PR / DaVinci）           | 匯入測試               |
| 首次使用上手時間 | ≤ 5 分鐘                       | 使用者測試觀察         |

### 9.2 長期目標

- **粗剪時間縮減**：相比人工粗剪減少 80% 以上
- **DAU**（Phase 3）：上線 3 個月內達 500 活躍用戶
- **NPS 分數**：≥ 40

---

## 10. 風險與對策

| 風險                                | 影響         | 機率 | 對策                                                  |
| ----------------------------------- | ------------ | ---- | ----------------------------------------------------- |
| Whisper 對中文口語 / 方言辨識率低   | 切片不準確   | 中   | 提供手動修正 UI；支援切換更大模型                     |
| 背景音樂 / 環境噪音干擾標記詞偵測   | 誤觸或漏觸   | 中   | 先分離人聲；增加信心分數閾值過濾                      |
| 大檔案（>2GB）處理記憶體不足        | 程式崩潰     | 低   | 分段處理音訊；串流式轉寫                              |
| FFmpeg / Whisper 系統相依性安裝困難 | 用戶安裝失敗 | 中   | Phase 2 打包為桌面 App 解決；Phase 1 提供 Docker 方案 |
| 使用者未使用標準標記詞              | 標記遺漏     | 高   | 引導 UI + 自定義關鍵字 + 模糊比對                     |

---

## 11. 非目標（Out of Scope for Phase 1）

- ❌ 使用者帳號 / 登入系統
- ❌ 雲端儲存與運算
- ❌ B-roll 自動推薦
- ❌ 靜音自動切除（列入 Phase 1.5 規劃）
- ❌ 多人協作功能
- ❌ 即時串流處理（必須先錄完再上傳）

---

## 12. Phase 1 開發里程碑

| 週次 | 里程碑                     | 交付物                                          |
| ---- | -------------------------- | ----------------------------------------------- |
| W1   | 核心引擎 — 音訊提取 + STT  | FFmpeg 整合、Whisper 本地推論、逐字稿 JSON 輸出 |
| W2   | 核心引擎 — 切片邏輯 + 匯出 | 標記詞比對、片段切片、EDL/XML 生成              |
| W3   | 後端 API                   | FastAPI 完整 REST API、專案 CRUD、檔案上傳      |
| W4   | 前端 UI — 上傳 + 預覽      | 專案列表、拖放上傳、影片播放器、逐字稿面板      |
| W5   | 前端 UI — 時間軸 + 微調    | 視覺化時間軸、切點拖曳調整、片段開關            |
| W6   | 整合測試 + 修正            | 端對端測試、效能優化、文件撰寫                  |

---

## 13. 回滾策略

- **資料安全**：所有操作皆不修改原始影片檔案，切片結果獨立儲存
- **版本控制**：專案分析結果可重新執行覆蓋，歷史結果保留
- **故障恢復**：處理中斷時，透過任務狀態旗標恢復至上次穩定狀態

---

## 附錄 A：目錄結構規劃（Phase 1）

```
ClipFlow-AI/
├── backend/                    # Python FastAPI 後端
│   ├── app/
│   │   ├── main.py             # FastAPI 進入點
│   │   ├── api/                # 路由定義
│   │   │   ├── projects.py
│   │   │   ├── segments.py
│   │   │   ├── export.py
│   │   │   └── settings.py
│   │   ├── core/               # 核心引擎
│   │   │   ├── audio.py        # FFmpeg 音訊提取
│   │   │   ├── transcribe.py   # Whisper STT
│   │   │   ├── marker.py       # 標記詞偵測
│   │   │   ├── slicer.py       # 片段切片邏輯
│   │   │   └── exporter.py     # EDL/XML/SRT 生成
│   │   ├── models/             # 資料模型 (Pydantic)
│   │   └── utils/
│   ├── pyproject.toml
│   └── tests/
├── frontend/                   # Next.js 前端
│   ├── src/
│   │   ├── app/
│   │   ├── components/
│   │   │   ├── VideoPlayer.tsx
│   │   │   ├── Timeline.tsx
│   │   │   ├── TranscriptPanel.tsx
│   │   │   └── ExportDialog.tsx
│   │   └── lib/
│   └── package.json
├── data/                       # 本地專案資料（gitignore）
├── docs/
│   └── PRD.md
├── docker-compose.yml          # 可選：容器化部署
└── README.md
```

---

## 附錄 B：EDL 匯出格式範例

```
TITLE: EP12_clipflow_export
FCM: NON-DROP FRAME

001  AX       V     C        00:00:15:06 00:00:42:24 00:00:00:00 00:00:27:18
* FROM CLIP NAME: EP12_raw.mp4

002  AX       V     C        00:01:03:12 00:01:28:00 00:00:27:18 00:00:52:06
* FROM CLIP NAME: EP12_raw.mp4
```
